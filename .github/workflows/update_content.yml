name: Update Content List

on:
  push:
    paths:
      - 'Games/**'
      - 'Interactive_Activities/**'

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
    - uses: actions/checkout@v3

    - name: Generate JSON with Node.js
      uses: actions/github-script@v6
      with:
        script: |
          const fs = require('fs');
          const path = require('path');

          const gamesDir = 'Games';
          const activitiesDir = 'Interactive_Activities';
          let results = [];

          // 1. GAMES KLASÃ–RÃœNÃœ TARA
          if (fs.existsSync(gamesDir)) {
            // SÄ±nÄ±f klasÃ¶rlerini oku (9TH_GRADE, 10TH_GRADE...)
            fs.readdirSync(gamesDir).forEach(grade => {
              const gradePath = path.join(gamesDir, grade);
              if (fs.statSync(gradePath).isDirectory()) {
                // Oyun klasÃ¶rlerini oku (Milyoner, Jeopardy...)
                fs.readdirSync(gradePath).forEach(gameName => {
                  const gamePath = path.join(gradePath, gameName);
                  // EÄŸer klasÃ¶rse ve iÃ§inde index.html varsa listeye ekle
                  if (fs.statSync(gamePath).isDirectory()) {
                    if (fs.existsSync(path.join(gamePath, 'index.html'))) {
                      results.push({
                        name: gameName, // KlasÃ¶r adÄ± oyun adÄ± olur
                        path: `${gamesDir}/${grade}/${gameName}/index.html`,
                        type: 'dir',
                        grade: grade,
                        source: 'Games'
                      });
                    }
                  }
                });
              }
            });
          }

          // 2. INTERACTIVE ACTIVITIES KLASÃ–RÃœNÃœ TARA
          if (fs.existsSync(activitiesDir)) {
            fs.readdirSync(activitiesDir).forEach(grade => {
              const gradePath = path.join(activitiesDir, grade);
              if (fs.statSync(gradePath).isDirectory()) {
                // DosyalarÄ± oku
                fs.readdirSync(gradePath).forEach(file => {
                  // Sadece .html dosyalarÄ±nÄ± al
                  if (file.endsWith('.html')) {
                    results.push({
                      name: file, // Dosya adÄ± (Ã¶rn: azerbaijan.html)
                      path: `${activitiesDir}/${grade}/${file}`,
                      type: 'file',
                      grade: grade,
                      source: 'Interactive_Activities'
                    });
                  }
                });
              }
            });
          }

          // DosyayÄ± yaz (Pretty print formatÄ±nda)
          fs.writeFileSync('games_data.json', JSON.stringify(results, null, 2));

    - name: Commit and Push
      run: |
        git config --global user.name 'GitHub Action'
        git config --global user.email 'action@github.com'
        git add games_data.json
        git diff --quiet && git diff --staged --quiet || (git commit -m "Update games list (Node.js Fix) ðŸš€" && git push)
