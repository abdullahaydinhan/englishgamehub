<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeopardy Oyunu</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background: linear-gradient(to bottom, #1e90ff, #87cefa);
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }
        .start-screen, .game-screen {
            display: none;
        }
        .start-screen.active, .game-screen.active {
            display: block;
        }
        h1 {
            font-family: 'Impact', sans-serif;
            font-size: 48px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        .group-scores {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 20px;
        }
        .group-score {
            background-color: #32cd32;
            padding: 15px;
            border-radius: 8px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease;
        }
        .group-score.animate {
            transform: scale(1.1);
        }
        .leaderboard-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }
        .leaderboard-content {
            background-color: #f0f8ff;
            color: black;
            padding: 20px;
            border-radius: 15px;
            width: 300px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        .leaderboard-content h3 {
            margin: 0 0 10px 0;
            font-size: 24px;
            color: #1e90ff;
        }
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 10px;
            font-size: 18px;
        }
        .board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }
        .category {
            background-color: #4169e1;
            padding: 15px;
            font-weight: bold;
            font-size: 24px;
            border: 2px solid #000;
        }
        .question {
            background-color: #0000cd;
            color: white;
            padding: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            border: 2px solid #000;
            transition: transform 0.2s, box-shadow 0.3s;
        }
        .question:hover {
            transform: scale(1.05);
        }
        .question:active {
            box-shadow: 0 0 15px rgba(255, 255, 0, 0.8);
        }
        .question.disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #f0f8ff;
            color: black;
            padding: 30px;
            border-radius: 15px;
            width: 600px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        .modal-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .highlight {
            background-color: #ffd700;
            color: black;
            padding: 5px;
            border-radius: 5px;
            font-weight: bold;
        }
        .congrats-message {
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
            color: #32cd32;
        }
        .round-summary {
            margin-top: 20px;
            border-top: 1px solid #ccc;
            padding-top: 10px;
        }
        .round-summary h4 {
            margin: 0 0 10px 0;
        }
        .round-summary-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
        }
        .gain {
            color: #32cd32;
        }
        .loss {
            color: #ff4040;
        }
        .edit-questions-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .edit-questions-table th, .edit-questions-table td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }
        .edit-questions-table th {
            background-color: #4682b4;
            color: white;
            cursor: pointer;
        }
        .edit-questions-table th:hover {
            background-color: #5a9bd4;
        }
        .edit-questions-table input, .edit-questions-table select {
            width: 100%;
            padding: 5px;
            box-sizing: border-box;
        }
        .filter-controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .duration-inputs {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .duration-inputs div {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            background-color: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 8px;
            width: 200px;
            transition: transform 0.3s ease, background-color 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s ease forwards;
        }
        .duration-inputs div:hover {
            transform: scale(1.05);
            background-color: rgba(255, 255, 255, 0.2);
        }
        .duration-inputs div:nth-child(1) { animation-delay: 0.1s; }
        .duration-inputs div:nth-child(2) { animation-delay: 0.2s; }
        .duration-inputs div:nth-child(3) { animation-delay: 0.3s; }
        .duration-inputs div:nth-child(4) { animation-delay: 0.4s; }
        .duration-inputs div:nth-child(5) { animation-delay: 0.5s; }
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .duration-inputs label {
            font-size: 16px;
            font-weight: bold;
        }
        .duration-inputs input[type="range"] {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #4682b4;
            border-radius: 5px;
            outline: none;
            transition: background 0.3s;
        }
        .duration-inputs input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #ff4500;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }
        .duration-inputs input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #ff4500;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        }
        .duration-inputs input[type="range"].short {
            background: #ff4040;
        }
        .duration-inputs input[type="range"].medium {
            background: #ffd700;
        }
        .duration-inputs input[type="range"].long {
            background: #32cd32;
        }
        .duration-inputs input[type="range"].short:hover {
            background: #ff6666;
        }
        .duration-inputs input[type="range"].medium:hover {
            background: #ffe066;
        }
        .duration-inputs input[type="range"].long:hover {
            background: #3cb371;
        }
        .duration-value {
            font-size: 14px;
            color: #ffd700;
            font-weight: bold;
        }
        .duration-scale {
            display: flex;
            justify-content: space-between;
            width: 100%;
            font-size: 12px;
            color: #ffffff;
            margin-top: 5px;
        }
        .duration-scale span {
            flex: 1;
            text-align: center;
        }
        .reset-durations-button {
            background-color: #4682b4;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 8px;
            margin: 10px 0;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }
        .reset-durations-button:hover {
            background-color: #5a9bd4;
        }
        button {
            padding: 12px 25px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: background-color 0.3s;
        }
        .start-button {
            background-color: #ff4500;
            color: white;
            padding: 20px 40px;
            font-size: 28px;
            border-radius: 12px;
            margin-top: 30px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }
        .start-button:hover {
            background-color: #ff6347;
        }
        .restart-button, .leaderboard-button, .edit-questions-button, .reset-questions-button {
            background-color: #ff4500;
            color: white;
            padding: 15px 30px;
            font-size: 20px;
            border-radius: 8px;
            margin: 20px 10px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }
        .restart-button:hover, .leaderboard-button:hover, .edit-questions-button:hover, .reset-questions-button:hover {
            background-color: #ff6347;
        }
        .modal-content button {
            background-color: #4682b4;
            color: white;
        }
        .modal-content button:hover {
            background-color: #5a9bd4;
        }
        .modal-buttons button:first-child {
            background-color: #32cd32;
        }
        .modal-buttons button:first-child:hover {
            background-color: #3cb371;
        }
        .modal-buttons button:last-child {
            background-color: #ff4040;
        }
        .modal-buttons button:last-child:hover {
            background-color: #ff6666;
        }
        footer {
            margin-top: 20px;
            font-size: 14px;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.2);
        }
        /* Mobil Uyumluluk */
        @media (max-width: 768px) {
            .duration-inputs div {
                width: 150px;
            }
            .duration-inputs label {
                font-size: 14px;
            }
            .duration-value {
                font-size: 12px;
            }
            .start-button, .reset-durations-button {
                padding: 15px 30px;
                font-size: 20px;
            }
            .board {
                grid-template-columns: repeat(3, 1fr);
                gap: 5px;
            }
            .category, .question {
                font-size: 16px;
                padding: 10px;
            }
            .question {
                border-radius: 25%;
            }
        }
        @media (max-width: 480px) {
            .duration-inputs div {
                width: 100%;
                margin: 5px 0;
            }
            .start-button, .reset-durations-button {
                padding: 10px 20px;
                font-size: 16px;
            }
            .board {
                grid-template-columns: repeat(2, 1fr);
            }
            .category, .question {
                font-size: 14px;
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Başlangıç Ekranı -->
        <div class="start-screen active">
            <h1>Jeopardy Oyunu</h1>
            <div>
                <label for="group-count">Grup Sayısı:</label>
                <select id="group-count">
                    <option value="2">2 Grup</option>
                    <option value="3">3 Grup</option>
                    <option value="4">4 Grup</option>
                </select>
            </div>
            <div class="duration-inputs">
                <div>
                    <label for="duration-50">50 Puan Süresi:</label>
                    <input type="range" id="duration-50" min="10" max="120" value="30">
                    <span class="duration-value" id="duration-50-value">30 sn</span>
                    <div class="duration-scale">
                        <span>10</span>
                        <span>30</span>
                        <span>60</span>
                        <span>90</span>
                        <span>120</span>
                    </div>
                </div>
                <div>
                    <label for="duration-100">100 Puan Süresi:</label>
                    <input type="range" id="duration-100" min="10" max="120" value="30">
                    <span class="duration-value" id="duration-100-value">30 sn</span>
                    <div class="duration-scale">
                        <span>10</span>
                        <span>30</span>
                        <span>60</span>
                        <span>90</span>
                        <span>120</span>
                    </div>
                </div>
                <div>
                    <label for="duration-150">150 Puan Süresi:</label>
                    <input type="range" id="duration-150" min="10" max="120" value="30">
                    <span class="duration-value" id="duration-150-value">30 sn</span>
                    <div class="duration-scale">
                        <span>10</span>
                        <span>30</span>
                        <span>60</span>
                        <span>90</span>
                        <span>120</span>
                    </div>
                </div>
                <div>
                    <label for="duration-200">200 Puan Süresi:</label>
                    <input type="range" id="duration-200" min="10" max="120" value="30">
                    <span class="duration-value" id="duration-200-value">30 sn</span>
                    <div class="duration-scale">
                        <span>10</span>
                        <span>30</span>
                        <span>60</span>
                        <span>90</span>
                        <span>120</span>
                    </div>
                </div>
                <div>
                    <label for="duration-250">250 Puan Süresi:</label>
                    <input type="range" id="duration-250" min="10" max="120" value="30">
                    <span class="duration-value" id="duration-250-value">30 sn</span>
                    <div class="duration-scale">
                        <span>10</span>
                        <span>30</span>
                        <span>60</span>
                        <span>90</span>
                        <span>120</span>
                    </div>
                </div>
            </div>
            <button class="reset-durations-button" onclick="resetDurations()">Varsayılan Sürelere Dön</button>
            <div>
                <label for="excel-file">Soru Dosyasını Seçin (Excel):</label>
                <input type="file" id="excel-file" accept=".xlsx, .xls">
            </div>
            <button class="start-button" onclick="loadExcelAndStartGame()">Başlat</button>
        </div>

        <!-- Soru Düzenleme Modülü -->
        <div class="modal" id="edit-questions-modal">
            <div class="modal-content">
                <h2>Soruları Düzenle</h2>
                <div class="filter-controls">
                    <div>
                        <label for="filter-points">Puana Göre Filtrele:</label>
                        <select id="filter-points">
                            <option value="">Tümü</option>
                            <option value="50">50</option>
                            <option value="100">100</option>
                            <option value="150">150</option>
                            <option value="200">200</option>
                            <option value="250">250</option>
                        </select>
                    </div>
                    <div>
                        <label for="filter-category">Kategoriye Göre Filtrele:</label>
                        <select id="filter-category">
                            <option value="">Tümü</option>
                            <option value="A">A</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                            <option value="D">D</option>
                            <option value="E">E</option>
                            <option value="F">F</option>
                        </select>
                    </div>
                </div>
                <table class="edit-questions-table" id="edit-questions-table">
                    <thead>
                        <tr>
                            <th onclick="sortTable('question')">Soru</th>
                            <th onclick="sortTable('answer')">Cevap</th>
                            <th onclick="sortTable('points')">Puan</th>
                            <th onclick="sortTable('category')">Kategori</th>
                            <th>İşlem</th>
                        </tr>
                    </thead>
                    <tbody id="edit-questions-body"></tbody>
                </table>
                <button onclick="addNewQuestionRow()">Yeni Soru Ekle</button>
                <div class="modal-buttons">
                    <button onclick="saveEditedQuestions()">Kaydet ve Oyuna Başla</button>
                    <button onclick="closeEditQuestionsModal()">İptal</button>
                </div>
            </div>
        </div>

        <!-- Oyun Ekranı -->
        <div class="game-screen">
            <h1>Jeopardy!!</h1>
            <div class="group-scores" id="group-scores"></div>
            <button class="leaderboard-button" onclick="showLeaderboard()">Lider Tablosunu Göster</button>
            <button class="edit-questions-button" onclick="showEditQuestionsModal()">Soruları Düzenle</button>
            <button class="reset-questions-button" onclick="resetUsedQuestions()">Tüm Soruları Sıfırla</button>
            <button class="restart-button" onclick="restartGame()">Tekrar Oyna</button>
            <div class="board" id="game-board"></div>
        </div>

        <!-- Lider Tablosu Modülü -->
        <div class="leaderboard-modal" id="leaderboard-modal">
            <div class="leaderboard-content">
                <h3>Lider Tablosu</h3>
                <div id="leaderboard-content"></div>
                <button onclick="hideLeaderboard()">Kapat</button>
            </div>
        </div>

        <!-- Soru Modülü -->
        <div class="modal" id="question-modal">
            <div class="modal-content">
                <h2 id="modal-question"></h2>
                <p>Puan: <span id="modal-points"></span></p>
                <p>Kalan Süre: <span id="modal-timer"></span> saniye</p>
                <button onclick="submitAnswer()">OK</button>
            </div>
        </div>

        <!-- Cevap Modülü -->
        <div class="modal" id="answer-modal">
            <div class="modal-content">
                <h2>Cevap</h2>
                <p id="modal-answer"></p>
                <div class="modal-buttons">
                    <button onclick="markCorrect()">Doğru</button>
                    <button onclick="markWrong()">Yanlış</button>
                </div>
                <button onclick="closeAnswerModal()">Kapat</button>
            </div>
        </div>

        <!-- Ara Puan Durumu Modülü -->
        <div class="modal" id="round-summary-modal">
            <div class="modal-content">
                <h2>Ara Puan Durumu</h2>
                <div id="congrats-message" class="congrats-message"></div>
                <div id="round-summary-scores"></div>
                <div class="round-summary">
                    <h4>Tur Özeti</h4>
                    <div id="round-summary-details"></div>
                </div>
                <button onclick="closeRoundSummary()">Devam Et</button>
            </div>
        </div>

        <!-- Oyun Sonu Modülü -->
        <div class="modal" id="game-over-modal">
            <div class="modal-content">
                <h2>Oyun Bitti!</h2>
                <div id="final-congrats-message" class="congrats-message"></div>
                <div id="final-scores"></div>
                <div class="round-summary">
                    <h4>Son Tur Özeti</h4>
                    <div id="final-round-summary-details"></div>
                </div>
                <button onclick="restartGame()">Yeniden Oyna</button>
            </div>
        </div>
    </div>

    <footer>
        Bu oyun İngilizce öğretmeni Abdullah AYDINHAN tarafından hazırlanmıştır.
    </footer>

    <!-- Ses Efektleri -->
   <audio id="tick-sound" src="tick.mp3"></audio>
	<audio id="correct-sound" src="correct.mp3"></audio>
	<audio id="wrong-sound" src="wrong.mp3"></audio>
    <!-- SheetJS Kütüphanesi -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script>
        let groups = [];
        let currentGroup = 0;
        let pointDurations = {
            50: 30,
            100: 30,
            150: 30,
            200: 30,
            250: 30
        };
        let timer;
        let currentQuestion = null;
        let answeredQuestions = 0;
        const totalQuestions = 30;
        let lastScoreChange = null;
        let questions = {
            A: [],
            B: [],
            C: [],
            D: [],
            E: [],
            F: []
        };
        let allQuestions = [];
        let usedQuestions = new Set();
        let sortDirection = 1;

        const tickSound = document.getElementById('tick-sound');
        const correctSound = document.getElementById('correct-sound');
        const wrongSound = document.getElementById('wrong-sound');

        // Kaydırıcı değerlerini güncelle
        function updateDurationValue(points) {
            const input = document.getElementById(`duration-${points}`);
            const valueSpan = document.getElementById(`duration-${points}-value`);
            valueSpan.textContent = `${input.value} sn`;

            // Renk değişimi
            const value = parseInt(input.value);
            input.classList.remove('short', 'medium', 'long');
            if (value <= 30) {
                input.classList.add('short');
            } else if (value <= 60) {
                input.classList.add('medium');
            } else {
                input.classList.add('long');
            }

            // Ses çal
            tickSound.play();
        }

        // Tüm kaydırıcılar için olay dinleyicisi ekle
        document.querySelectorAll('.duration-inputs input[type="range"]').forEach(input => {
            input.addEventListener('input', () => {
                const points = input.id.split('-')[1];
                updateDurationValue(points);
            });
        });

        // Varsayılan sürelere dön
        function resetDurations() {
            const pointsValues = [50, 100, 150, 200, 250];
            pointsValues.forEach(points => {
                const input = document.getElementById(`duration-${points}`);
                input.value = 30;
                updateDurationValue(points);
            });
            alert('Süreler varsayılan değerlere (30 saniye) sıfırlandı.');
        }

        // Excel dosyasını okuma ve oyunu başlatma
        function loadExcelAndStartGame() {
            const fileInput = document.getElementById('excel-file');
            const file = fileInput.files[0];

            if (!file) {
                alert('Lütfen bir Excel dosyası seçin!');
                return;
            }

            // Süreleri al ve kontrol et
            pointDurations = {
                50: parseInt(document.getElementById('duration-50').value),
                100: parseInt(document.getElementById('duration-100').value),
                150: parseInt(document.getElementById('duration-150').value),
                200: parseInt(document.getElementById('duration-200').value),
                250: parseInt(document.getElementById('duration-250').value)
            };

            // Sürelerin geçerliliğini kontrol et
            for (let points in pointDurations) {
                const duration = pointDurations[points];
                if (isNaN(duration) || duration < 10 || duration > 120) {
                    alert(`${points} puan için süre 10 ile 120 saniye arasında olmalıdır! (Girilen değer: ${duration})`);
                    return;
                }
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                // Soruları işleme ve doğrulama
                allQuestions = [];
                let invalidQuestions = [];
                for (let i = 1; i < json.length; i++) {
                    const row = json[i];
                    if (row[0] && row[1] && row[2]) {
                        const question = row[0].toString().trim();
                        const answer = row[1].toString().trim();
                        const points = parseInt(row[2]);
                        const validPoints = [50, 100, 150, 200, 250].includes(points);

                        if (question && answer && validPoints) {
                            allQuestions.push({
                                question: question,
                                answer: answer,
                                points: points,
                                category: '',
                                id: i
                            });
                        } else {
                            invalidQuestions.push({
                                row: i + 1,
                                reason: !question ? "Soru boş" : !answer ? "Cevap boş" : "Geçersiz puan (50, 100, 150, 200, 250 olmalı)"
                            });
                        }
                    }
                }

                // Doğrulama sonuçlarını göster
                if (invalidQuestions.length > 0) {
                    let errorMessage = "Aşağıdaki satırlarda geçersiz sorular bulundu:\n";
                    invalidQuestions.forEach(error => {
                        errorMessage += `Satır ${error.row}: ${error.reason}\n`;
                    });
                    alert(errorMessage);
                }

                if (allQuestions.length < totalQuestions) {
                    alert(`Yeterli soru bulunamadı! En az ${totalQuestions} soru gereklidir, ancak ${allQuestions.length} soru yüklendi. Eksik sorular için varsayılan sorular kullanılacak.`);
                }

                // Oyunu başlat
                startGame();
            };
            reader.readAsArrayBuffer(file);
        }

        // Soru düzenleme ekranını aç
        function showEditQuestionsModal() {
            const modal = document.getElementById('edit-questions-modal');
            const tbody = document.getElementById('edit-questions-body');
            const filterPoints = document.getElementById('filter-points');
            const filterCategory = document.getElementById('filter-category');

            // Filtreleme olay dinleyicileri
            filterPoints.onchange = updateEditQuestionsTable;
            filterCategory.onchange = updateEditQuestionsTable;

            updateEditQuestionsTable();
            modal.style.display = 'flex';
        }

        // Düzenleme tablosunu güncelle
        function updateEditQuestionsTable() {
            const tbody = document.getElementById('edit-questions-body');
            const filterPoints = document.getElementById('filter-points').value;
            const filterCategory = document.getElementById('filter-category').value;

            let filteredQuestions = [...allQuestions];
            if (filterPoints) {
                filteredQuestions = filteredQuestions.filter(q => q.points === parseInt(filterPoints));
            }
            if (filterCategory) {
                filteredQuestions = filteredQuestions.filter(q => q.category === filterCategory);
            }

            tbody.innerHTML = '';
            filteredQuestions.forEach((q, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" value="${q.question}" data-index="${index}" class="edit-question"></td>
                    <td><input type="text" value="${q.answer}" data-index="${index}" class="edit-answer"></td>
                    <td><input type="number" value="${q.points}" data-index="${index}" class="edit-points"></td>
                    <td>
                        <select data-index="${index}" class="edit-category">
                            <option value="" ${q.category === '' ? 'selected' : ''}>Seçiniz</option>
                            <option value="A" ${q.category === 'A' ? 'selected' : ''}>A</option>
                            <option value="B" ${q.category === 'B' ? 'selected' : ''}>B</option>
                            <option value="C" ${q.category === 'C' ? 'selected' : ''}>C</option>
                            <option value="D" ${q.category === 'D' ? 'selected' : ''}>D</option>
                            <option value="E" ${q.category === 'E' ? 'selected' : ''}>E</option>
                            <option value="F" ${q.category === 'F' ? 'selected' : ''}>F</option>
                        </select>
                    </td>
                    <td><button onclick="deleteQuestionRow(${index})">Sil</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        // Tabloyu sırala
        function sortTable(field) {
            allQuestions.sort((a, b) => {
                let valA = a[field];
                let valB = b[field];
                if (field === 'points') {
                    valA = parseInt(valA);
                    valB = parseInt(valB);
                }
                if (valA < valB) return -sortDirection;
                if (valA > valB) return sortDirection;
                return 0;
            });
            sortDirection = -sortDirection;
            updateEditQuestionsTable();
        }

        // Yeni soru satırı ekle
        function addNewQuestionRow() {
            const tbody = document.getElementById('edit-questions-body');
            const index = allQuestions.length;
            allQuestions.push({
                question: '',
                answer: '',
                points: 50,
                category: '',
                id: Date.now()
            });
            updateEditQuestionsTable();
        }

        // Soru satırını sil
        function deleteQuestionRow(index) {
            allQuestions.splice(index, 1);
            updateEditQuestionsTable();
        }

        // Düzenlenen soruları kaydet ve oyuna başla
        function saveEditedQuestions() {
            const questionsInputs = document.querySelectorAll('.edit-question');
            const answersInputs = document.querySelectorAll('.edit-answer');
            const pointsInputs = document.querySelectorAll('.edit-points');
            const categoryInputs = document.querySelectorAll('.edit-category');

            allQuestions = [];
            let invalidQuestions = [];
            questionsInputs.forEach((input, index) => {
                const question = input.value.trim();
                const answer = answersInputs[index].value.trim();
                const points = parseInt(pointsInputs[index].value);
                const category = categoryInputs[index].value;
                const validPoints = [50, 100, 150, 200, 250].includes(points);

                if (question && answer && validPoints) {
                    allQuestions.push({
                        question: question,
                        answer: answer,
                        points: points,
                        category: category,
                        id: Date.now() + index
                    });
                } else {
                    invalidQuestions.push({
                        row: index + 1,
                        reason: !question ? "Soru boş" : !answer ? "Cevap boş" : "Geçersiz puan (50, 100, 150, 200, 250 olmalı)"
                    });
                }
            });

            if (invalidQuestions.length > 0) {
                let errorMessage = "Aşağıdaki satırlarda geçersiz sorular bulundu:\n";
                invalidQuestions.forEach(error => {
                    errorMessage += `Satır ${error.row}: ${error.reason}\n`;
                });
                alert(errorMessage);
                return;
            }

            if (allQuestions.length < totalQuestions) {
                alert(`Yeterli soru bulunamadı! En az ${totalQuestions} soru gereklidir, ancak ${allQuestions.length} soru var. Eksik sorular için varsayılan sorular kullanılacak.`);
            }

            closeEditQuestionsModal();
            startGame();
        }

        // Soru düzenleme modülünü kapat
        function closeEditQuestionsModal() {
            document.getElementById('edit-questions-modal').style.display = 'none';
        }

        // Kullanılmış soruları sıfırla
        function resetUsedQuestions() {
            usedQuestions.clear();
            alert('Tüm sorular sıfırlandı! Artık tüm sorular tekrar kullanılabilir.');
        }

        // Oyunu başlat
        function startGame() {
            const groupCount = parseInt(document.getElementById('group-count').value);

            // Grupları başlat
            groups = Array.from({ length: groupCount }, (_, i) => ({
                name: `${i + 1}. Grup`,
                score: 0
            }));
            answeredQuestions = 0;
            lastScoreChange = null;

            // Soruları kategorilere ve puan değerlerine göre gruplandırma
            const categories = ['A', 'B', 'C', 'D', 'E', 'F'];
            const pointsValues = [50, 100, 150, 200, 250];
            const availableQuestions = allQuestions.filter(q => !usedQuestions.has(q.id));

            // Kategorilere göre soruları dağıt
            categories.forEach(category => {
                questions[category] = [];
                const categoryQuestions = availableQuestions.filter(q => q.category === category || q.category === '');
                const pointsGroups = {
                    50: categoryQuestions.filter(q => q.points === 50),
                    100: categoryQuestions.filter(q => q.points === 100),
                    150: categoryQuestions.filter(q => q.points === 150),
                    200: categoryQuestions.filter(q => q.points === 200),
                    250: categoryQuestions.filter(q => q.points === 250)
                };

                pointsValues.forEach(points => {
                    const availableQuestionsForPoints = pointsGroups[points];
                    if (availableQuestionsForPoints.length > 0) {
                        const randomIndex = Math.floor(Math.random() * availableQuestionsForPoints.length);
                        const selectedQuestion = availableQuestionsForPoints.splice(randomIndex, 1)[0];
                        questions[category].push(selectedQuestion);
                        usedQuestions.add(selectedQuestion.id);
                    } else {
                        const defaultQuestion = {
                            question: "Bu bir örnek sorudur.",
                            answer: "Cevap",
                            points: points,
                            category: category,
                            id: `default-${category}-${points}`
                        };
                        questions[category].push(defaultQuestion);
                        usedQuestions.add(defaultQuestion.id);
                    }
                });
            });

            // Grup puanlarını ve lider tablosunu güncelle
            updateScores();
            updateLeaderboard();

            // Oyun tahtasını oluştur
            const gameBoard = document.getElementById('game-board');
            gameBoard.innerHTML = `
                <div class="category">A</div>
                <div class="category">B</div>
                <div class="category">C</div>
                <div class="category">D</div>
                <div class="category">E</div>
                <div class="category">F</div>
            `;
            for (let i = 0; i < 5; i++) {
                ['A', 'B', 'C', 'D', 'E', 'F'].forEach(category => {
                    const points = [50, 100, 150, 200, 250][i];
                    gameBoard.innerHTML += `
                        <div class="question" data-category="${category}" data-index="${i}" onclick="openQuestion('${category}', ${i})">
                            ${points} PUAN
                        </div>
                    `;
                });
            }

            // Oyun ekranına geçiş yap
            document.querySelector('.start-screen').classList.remove('active');
            document.querySelector('.game-screen').classList.add('active');
        }

        function openQuestion(category, index) {
            currentQuestion = questions[category][index];
            const modal = document.getElementById('question-modal');
            document.getElementById('modal-question').textContent = currentQuestion.question;
            document.getElementById('modal-points').textContent = currentQuestion.points;

            // Sorunun puan değerine göre süreyi belirle
            const timerDuration = pointDurations[currentQuestion.points];
            document.getElementById('modal-timer').textContent = timerDuration;
            modal.style.display = 'flex';

            // Soruyu devre dışı bırak
            const questionElement = document.querySelector(`.question[data-category="${category}"][data-index="${index}"]`);
            questionElement.classList.add('disabled');
            questionElement.onclick = null;

            // Süreyi başlat
            let timeLeft = timerDuration;
            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('modal-timer').textContent = timeLeft;
                tickSound.play();
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    modal.style.display = 'none';
                    showAnswer();
                }
            }, 1000);
        }

        function submitAnswer() {
            clearInterval(timer);
            document.getElementById('question-modal').style.display = 'none';
            showAnswer();
        }

        function showAnswer() {
            const modal = document.getElementById('answer-modal');
            document.getElementById('modal-answer').textContent = `Doğru Cevap: ${currentQuestion.answer}`;
            modal.style.display = 'flex';
            answeredQuestions++;
        }

        function markCorrect() {
            const points = currentQuestion.points;
            groups[currentGroup].score += points;
            lastScoreChange = { group: groups[currentGroup].name, change: points };
            updateScores(true);
            updateLeaderboard();
            correctSound.play();
            closeAnswerModal();
            showRoundSummary();
        }

        function markWrong() {
            const points = currentQuestion.points;
            groups[currentGroup].score -= points;
            lastScoreChange = { group: groups[currentGroup].name, change: -points };
            updateScores(true);
            updateLeaderboard();
            wrongSound.play();
            closeAnswerModal();
            showRoundSummary();
        }

        function closeAnswerModal() {
            document.getElementById('answer-modal').style.display = 'none';
            currentGroup = (currentGroup + 1) % groups.length;
        }

        function updateScores(animate = false) {
            const groupScoresDiv = document.getElementById('group-scores');
            groupScoresDiv.innerHTML = groups.map(group => `
                <div class="group-score ${animate ? 'animate' : ''}">
                    ${group.name}: <span>${group.score}</span>
                </div>
            `).join('');
        }

        function updateLeaderboard() {
            const leaderboardContent = document.getElementById('leaderboard-content');
            const sortedGroups = [...groups].sort((a, b) => b.score - a.score);
            leaderboardContent.innerHTML = sortedGroups.map(group => `
                <div class="leaderboard-item">
                    <span>${group.name}</span>
                    <span>${group.score} puan</span>
                </div>
            `).join('');
        }

        function showLeaderboard() {
            document.getElementById('leaderboard-modal').style.display = 'flex';
        }

        function hideLeaderboard() {
            document.getElementById('leaderboard-modal').style.display = 'none';
        }

        function showRoundSummary() {
            if (answeredQuestions >= totalQuestions) {
                showGameOver();
            } else {
                const modal = document.getElementById('round-summary-modal');
                const congratsMessage = document.getElementById('congrats-message');
                const roundSummaryScores = document.getElementById('round-summary-scores');
                const roundSummaryDetails = document.getElementById('round-summary-details');
                const sortedGroups = [...groups].sort((a, b) => b.score - a.score);
                const highestScore = sortedGroups[0].score;
                const leaders = sortedGroups.filter(group => group.score === highestScore);

                // Tebrik mesajı
                if (leaders.length === 1) {
                    congratsMessage.textContent = `Tebrikler ${leaders[0].name}, bu turda lider oldunuz!`;
                } else {
                    const leaderNames = leaders.map(leader => leader.name).join(', ');
                    congratsMessage.textContent = `Tebrikler ${leaderNames}, bu turda liderliği paylaşıyorsunuz!`;
                }

                // Ara puan durumu
                roundSummaryScores.innerHTML = sortedGroups.map(group => `
                    <p ${group.score === highestScore ? 'class="highlight"' : ''}>
                        ${group.name}: ${group.score} puan
                    </p>
                `).join('');

                // Tur özeti
                if (lastScoreChange) {
                    const changeClass = lastScoreChange.change > 0 ? 'gain' : 'loss';
                    const changeText = lastScoreChange.change > 0 ? `+${lastScoreChange.change}` : lastScoreChange.change;
                    roundSummaryDetails.innerHTML = `
                        <div class="round-summary-item">
                            <span>${lastScoreChange.group}</span>
                            <span class="${changeClass}">${changeText} puan</span>
                        </div>
                    `;
                } else {
                    roundSummaryDetails.innerHTML = '<p>Bu turda puan değişikliği olmadı.</p>';
                }

                modal.style.display = 'flex';
            }
        }

        function closeRoundSummary() {
            document.getElementById('round-summary-modal').style.display = 'none';
        }

        function showGameOver() {
            const modal = document.getElementById('game-over-modal');
            const finalCongratsMessage = document.getElementById('final-congrats-message');
            const finalScoresDiv = document.getElementById('final-scores');
            const finalRoundSummaryDetails = document.getElementById('final-round-summary-details');
            const sortedGroups = [...groups].sort((a, b) => b.score - a.score);
            const highestScore = sortedGroups[0].score;
            const leaders = sortedGroups.filter(group => group.score === highestScore);

            // Tebrik mesajı
            if (leaders.length === 1) {
                finalCongratsMessage.textContent = `Tebrikler ${leaders[0].name}, oyunu kazandınız!`;
            } else {
                const leaderNames = leaders.map(leader => leader.name).join(', ');
                finalCongratsMessage.textContent = `Tebrikler ${leaderNames}, oyunu berabere tamamladınız!`;
            }

            // Final puan durumu
            finalScoresDiv.innerHTML = sortedGroups.map(group => `
                <p ${group.score === highestScore ? 'class="highlight"' : ''}>
                    ${group.name}: ${group.score} puan
                </p>
            `).join('');

            // Son tur özeti
            if (lastScoreChange) {
                const changeClass = lastScoreChange.change > 0 ? 'gain' : 'loss';
                const changeText = lastScoreChange.change > 0 ? `+${lastScoreChange.change}` : lastScoreChange.change;
                finalRoundSummaryDetails.innerHTML = `
                    <div class="round-summary-item">
                        <span>${lastScoreChange.group}</span>
                        <span class="${changeClass}">${changeText} puan</span>
                    </div>
                `;
            } else {
                finalRoundSummaryDetails.innerHTML = '<p>Son turda puan değişikliği olmadı.</p>';
            }

            modal.style.display = 'flex';
            document.querySelector('.game-screen').classList.remove('active');
        }

        function restartGame() {
            document.getElementById('game-over-modal').style.display = 'none';
            document.querySelector('.game-screen').classList.remove('active');
            document.querySelector('.start-screen').classList.add('active');
            startGame();
        }
    </script>
</body>
</html>